\documentclass{article}
\usepackage[margin=0.7in]{geometry}
\usepackage{graphicx} %LaTeX package to import graphics
\usepackage{float} %LaTeX package to float images
\usepackage{tikz}
\usepackage{listings}

\begin{document}
\date{}
\title{Graphs}
\author{}
\maketitle
\graphicspath{{images/}} %configuring the graphicx package
\section*{207. Course Schedule}
\begin{flushleft}
    "There are a total of numCourses courses you have to take, labeled from 0 to numCourses - 1. You are given an array prerequisites where prerequisites[i] = [$a_i$, $b_i$] indicates that you must take course $b_i$ first if you want to take course $a_i$.
    Return \textbf{true} if you can finish all courses. Otherwise, return \textbf{false}."
\end{flushleft}
Key Concepts:
\begin{itemize}
    \item Adjacency Map
    \item DFS
    \item Cycle Detection
\end{itemize}

\begin{flushleft}
    To understand this problem it must first be noted that the schdule can be turned into a directed graph.
    We can interpret each course/prereq as a node (\textit{n}), if it is a prereq then its edge will point towards the node (course) that is leads to.
    For example, if our prerequisite list is [[1, 0], [2, 0], [3, 1]], then our graph would look like this:
\end{flushleft}
\begin{figure}[H]
    \centering
    \begin{tikzpicture}[node distance={15mm}, main/.style = {draw, circle}]
        \node[main] (0) {$0$};
        \node[main] (1) [above right of=0] {$1$};
        \node[main] (2) [below right of=0] {$2$};
        \node[main] (3) [right of=1] {$3$};
        \draw[->] (0) -- (1);
        \draw[->] (0) -- (2);
        \draw[->] (1) -- (3);
    \end{tikzpicture}
    \caption{0 is the parent (\textit{prereq}) of nodes 1 and 2, and 1 is the parent of 3}
\end{figure}

\begin{flushleft}
    To construct this graph we will need to a build an \underline{adjacency map}, however, in this problem we can use a list instead.
    The index of the list will correspond to a course number which will contain a list of its prerequisites.
    Referencing the above example our adjacency list would look like:
    \begin{lstlisting}[language=Python]
    [[1, 2], [3], [], []]
    \end{lstlisting}
    Each index (prerequisite) contains a list of the courses it leads to.
\end{flushleft}
\begin{flushleft}
    The second part will be to construct out DFS algorithm which will be used to check if, given a course, it is possible to complete it (e.g. graph does not contain a cycle).
    To do this we will need the course number and a list of courses we have taken so far (visited nodes).
    We can establish the list of visited nodes outside of the function to reduce redundancy, so far our DFS function looks like:
    \begin{lstlisting}[language=python]
        visited = set()
        def containsCycle(course):
            pass #indicates incomplete function
    \end{lstlisting}
    After this we can establish our base cases where either we have no prerequisites left (succesfully completed traversal)
    or we have encountered a node already we already visited (encountered a cycle). Once we have addressed these then we can assume
    we still have more nodes to traverse and we can add the current course to our visited set.
    \begin{lstlisting}[language=python]
        visited = set()
        def containsCycle(course):
            if crs in visited:
                return True
            if adjList[crs] == []:
                return False

            visited.add(crs)
    \end{lstlisting}
    Finally, we must get the prerequisites of our course from the adjacency list and iterate over them using a for loop and then recursively running our DFS algorithm on each prereq.
    If our function encounters a cycle we can return \textbf{false} indicating that there is a cycle, otherwise the loop will terminate.
    After exiting the loop we will remove the current course from the visited list. This will allow us to empty out our visited set completely
    after running our DFS function. We can also empty out the list of prereqs for the course we called the function on to save time on future iterations
    since we know that the course can be taken. Finally we can return \textbf{false} indicating that we have not encountered any cycles.
    \begin{lstlisting}[language=python]
        def containsCycle(crs):
            if crs in visited:
                return True
            if adjList[crs] == []:
                return False

            visited.add(crs)

            for pre in adjList[crs]:
                if containsCycle(pre):
                    return True
            visited.remove(crs)
            adjList[crs] = []
            return False
    \end{lstlisting}
\end{flushleft}
\begin{flushleft}
    The rest of the problem is trivial, we just need to loop over all courses and run our DFS on each one.
    If our DFS returns \textbf{true} then we know that there is a cycle starting from that node, therefore the course cannot be taken and we can return \textbf{false}.
    Otherwise the loop will complete indicating that we can complete every course in the schedule, and we can return \textbf{true}.
\end{flushleft}
\begin{flushleft}
    The complete solution will appear as follows:
    \begin{lstlisting}[language=python]
    class Solution:
        def canFinish(self, numCourses: int, prerequisites: List[List[int]]) -> bool:
            adjList = {i:[] for i in range(numCourses)} #construct adj list
    
            for crs, pre in prerequisites:
                adjList[crs].append(pre) #map course to prereqs
    
            visited = set()
    
            def containsCycle(crs):
                if crs in visited:
                    return True #cycle detected
                if adjList[crs] == []:
                    return False  #no cycle detected
    
                visited.add(crs)
    
                for pre in adjList[crs]: #recursively check course prereqs
                    if containsCycle(pre):
                        return True
                visited.remove(crs) #dump visited set
                adjList[crs] = [] #show course can be completed (light memoization)
                return False
    
            for n in range(numCourses): #check if all courses can be completed
                if containsCycle(n):
                    return False
    
            return True    
    \end{lstlisting}
\end{flushleft}
\end{document}